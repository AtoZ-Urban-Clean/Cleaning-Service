<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Book Service | AtoZ Urban Clean</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
body{ margin:0; font-family:'Segoe UI', Arial; background:#f6f6f6; color: #333; }

/* Adjusted Header Layout */
header {
  background:#fff; 
  padding:15px 20px; 
  display: flex; 
  align-items: center; 
  border-bottom:1px solid #ddd;
  position: sticky;
  top: 0;
  z-index: 1000;
}
header .company-name {
  flex: 1; /* Pushes the next item to the center */
  text-align: left;
}
header .company-name a {
  text-decoration: none; color: #0066ff; font-size: 20px; font-weight: 800;
}
header .page-title {
  flex: 2; /* Centers the title */
  text-align: center;
  font-size: 18px;
  font-weight: 600;
  color: #555;
}
header .spacer { flex: 1; } /* Keeps the title perfectly centered */

.container{ max-width:600px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }

.service-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.clear-btn { background: #eee; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; }

.service-item{ display:flex; align-items: center; padding:12px 0; border-bottom:1px solid #eee; gap: 10px; }
.item-info { flex-grow: 1; }
.qty-controls { display: flex; align-items: center; gap: 8px; }
.qty-btn { background: #f0f0f0; border: 1px solid #ccc; width: 25px; height: 25px; cursor: pointer; border-radius: 4px; }
.remove-btn { color: #ff0000; background: none; border: none; cursor: pointer; font-size: 18px; margin-left: 10px; }

.total{ font-size:20px; margin:20px 0; font-weight:700; text-align: right; color: #0066ff; }

label{ display:block; margin-top:15px; font-weight:600; font-size: 14px; }
.input-group { position: relative; }
input{ width:100%; padding:12px; margin-top:6px; border:1px solid #ccc; border-radius:6px; box-sizing: border-box; }

.gps-btn { position: absolute; right: 10px; top: 15px; background: none; border: none; color: #0066ff; cursor: pointer; font-size: 18px; }

button.main-btn{ width:100%; margin-top:25px; padding:15px; font-size:16px; background:#ff007f; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight: bold; }

.success{ text-align:center; display:none; }
.booking-id{ font-size:22px; color:green; margin:15px 0; font-weight: bold; }
.whatsapp{ display:block; margin-top:15px; padding:15px; background:#25D366; color:#fff; text-decoration:none; border-radius:6px; font-weight: bold; }

@media (max-width: 600px) {
    header .page-title { font-size: 14px; }
    header .company-name a { font-size: 16px; }
}
</style>
</head>

<body>

<header>
    <div class="company-name">
        <a href="index.html">AtoZ Urban Clean</a>
    </div>
    <div class="page-title">BOOK MY SERVICE</div>
    <div class="spacer"></div>
</header>

<div class="container" id="formBox">
    <div class="service-header">
        <h3>Selected Services</h3>
        <button class="clear-btn" onclick="clearAll()">Clear All</button>
    </div>
    
    <div id="serviceList"></div>

    <div class="total">Total: ₹<span id="amount">0</span></div>

    <label>Full Name</label>
    <input type="text" id="name" placeholder="Enter your name">

    <label>Mobile Number</label>
    <input type="tel" id="mobile" placeholder="Enter mobile number">

    <label>Location</label>
    <div class="input-group">
        <input type="text" id="location" placeholder="Address or GPS location">
        <button class="gps-btn" onclick="getLocation()" title="Use GPS"><i class="fas fa-location-crosshairs"></i></button>
    </div>

    <label>Preferred Date & Time</label>
    <div style="display: flex; gap: 10px;">
        <input type="date" id="date">
        <input type="time" id="time">
    </div>

    <button class="main-btn" onclick="confirmBooking()">Confirm & Book Now</button>
</div>

<div class="container success" id="successBox">
  <i class="fas fa-check-circle" style="font-size: 50px; color: #25D366;"></i>
  <h2>Booking Confirmed!</h2>
  <div class="booking-id">ID: <span id="bid"></span></div>
  <p>An email notification has been sent to Admin. Click below to also send details via WhatsApp.</p>

  <a id="waLink" class="whatsapp" target="_blank">
    <i class="fab fa-whatsapp"></i> Send Details to Admin
  </a>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];
const list = document.getElementById("serviceList");
const amountDisplay = document.getElementById("amount");

function loadCart(){
    if(cart.length === 0){
        list.innerHTML = "<p style='color:#888;'>Your bag is empty.</p>";
        amountDisplay.innerText = "0";
        return;
    }
    let total = 0;
    list.innerHTML = "";
    cart.forEach((item, index) => {
        const itemQty = item.qty || 1;
        const itemTotal = Number(item.price) * itemQty;
        total += itemTotal;
        const div = document.createElement("div");
        div.className = "service-item";
        div.innerHTML = `
            <div class="item-info">
                <div style="font-weight:600">${item.name}</div>
                <div style="font-size:12px; color:#666">₹${item.price} each</div>
            </div>
            <div class="qty-controls">
                <button class="qty-btn" onclick="updateQty(${index}, -1)">-</button>
                <span>${itemQty}</span>
                <button class="qty-btn" onclick="updateQty(${index}, 1)">+</button>
            </div>
            <b style="min-width:60px; text-align:right">₹${itemTotal}</b>
            <button class="remove-btn" onclick="removeItem(${index})"><i class="fas fa-trash"></i></button>
        `;
        list.appendChild(div);
    });
    amountDisplay.innerText = total;
}

function updateQty(index, change) {
    cart[index].qty = (cart[index].qty || 1) + change;
    if (cart[index].qty < 1) cart[index].qty = 1;
    saveAndReload();
}

function removeItem(index) {
    cart.splice(index, 1);
    saveAndReload();
}

function clearAll() {
    if(confirm("Remove all items?")) { cart = []; saveAndReload(); }
}

function saveAndReload() {
    localStorage.setItem("cart", JSON.stringify(cart));
    loadCart();
}

function getLocation() {
    const locInput = document.getElementById("location");
    if (navigator.geolocation) {
        locInput.value = "Fetching location...";
        navigator.geolocation.getCurrentPosition((position) => {
            locInput.value = `Lat: ${position.coords.latitude}, Long: ${position.coords.longitude}`;
        }, () => {
            alert("Unable to retrieve location. Please type manually.");
            locInput.value = "";
        });
    }
}

function confirmBooking(){
    const name = document.getElementById("name").value.trim();
    const mobile = document.getElementById("mobile").value.trim();
    const location = document.getElementById("location").value.trim();
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;

    if(!name || !mobile || !location || !date || !time){
        alert("Please fill in all details");
        return;
    }

    const bookingId = "AZC" + Math.floor(1000 + Math.random()*9000);
    const serviceDetails = cart.map(i => `${i.name} (x${i.qty || 1})`).join(", ");
    const total = amountDisplay.innerText;

    const summary = `Booking ID: ${bookingId}\nCustomer: ${name}\nMobile: ${mobile}\nLocation: ${location}\nSchedule: ${date} at ${time}\nServices: ${serviceDetails}\nTotal: ₹${total}`;

    // 1. AUTOMATIC EMAIL TRIGGER
    const adminEmail = "yuvasivasakthi.2002@gmail.com";
    const subject = encodeURIComponent(`New Booking: ${bookingId} - ${name}`);
    const emailBody = encodeURIComponent(summary);
    window.location.href = `mailto:${adminEmail}?subject=${subject}&body=${emailBody}`;

    // 2. PREPARE WHATSAPP
    const waNumber = "919489587626";
    const waText = encodeURIComponent(`*NEW BOOKING - AtoZ Urban Clean*\n----------------------------\n${summary}`);
    document.getElementById("waLink").href = `https://wa.me/${waNumber}?text=${waText}`;

    // UI UPDATE
    document.getElementById("bid").innerText = bookingId;
    document.getElementById("formBox").style.display="none";
    document.getElementById("successBox").style.display="block";

    localStorage.removeItem("cart");
}

loadCart();
</script>

</body>
</html>
